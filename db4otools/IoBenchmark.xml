<?xml version="1.0" encoding="UTF-8"?>
<project name="db4o-IoBenchmark" default="run.benchmark.small">

	<target name="init">
		<property file="IoBenchmark.properties" />
	</target>
	
	<target name="run.benchmark.small" depends="init">
		<run.benchmark object.count="${object.count.small}"/>
	</target>
	
	<target name="run.benchmark.medium" depends="init">
		<run.benchmark object.count="${object.count.medium}"/>
	</target>
	
	<target name="run.benchmark.large" depends="init">
		<run.benchmark object.count="${object.count.large}"/>
	</target>
	
	<macrodef name="run.benchmark">
		<attribute name="object.count" />
		<sequential>
			<condition property="run.delayed" value="true" else="false">
				<and>
					<length string="${results.file.1}" when="greater" length="0" />
					<length string="${results.file.2}" when="greater" length="0" />
				</and>
			</condition>
			<condition property="adjust.delays.true" value="true" else="">
				<and>
					<istrue value="${run.delayed}" />
					<istrue value="${adjust.delays}" />
				</and>
			</condition>
			<condition property="adjust.delays.false" value="false" else="">
				<and>
					<istrue value="${run.delayed}" />
					<isfalse value="${adjust.delays}" />
				</and>
			</condition>
			<java classname="com.db4o.bench.IoBenchmark" failonerror="true" fork="true">
				<classpath>
					<pathelement location="bin"/>
					<pathelement location="lib/${db4o.jar}"/>
					<pathelement location="lib/nano-timing.jar"/>
				</classpath>
				<jvmarg line="${jvm.args}"/>
				<arg line="@{object.count}" />
				<arg line="${db.file.name}" />
				<arg line="${results.file.1}" />
				<arg line="${results.file.2}" />
				<arg line="${adjust.delays.true}"/>
				<arg line="${adjust.delays.false}"/>
			</java>
		</sequential>
	</macrodef>
	
</project>