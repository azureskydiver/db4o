<?xml version="1.0"?>
<project name="db4o instrumentation tool" default="build">	

	<property name="dir.build" location="../../db4obuild" />
	<property file="${dir.build}/machine.properties" />
	<property file="${dir.build}/ant.properties" />
	
	<property name="output.dir" location="bin" />	

	<target name="build" depends="init">
		<csc outputfile="${output.dir}/Db4oAdmin.exe"
			targettype="exe"
			debug="true"
			executable="${csc.executable}">
			<src dir="Db4oAdmin">
				<include name="**/*.cs" />
			</src>
			<reference dir="${output.dir}">
				<include name="*.dll" />
			</reference>
		</csc>
	</target>
	
	<target name="test" depends="rebuild">
		
		<csc outputfile="${output.dir}/Db4oAdmin.Tests.exe"
			targettype="exe"
			debug="true"
			executable="${csc.executable}">
			<src dir="Db4oAdmin.Tests">
				<include name="**/*.cs" />
				
				<!-- embedded resource -->
				<exclude name="**/Resources/**" />
				<exclude name="**/obj/**" />
			</src>
			<reference dir="${output.dir}">
				<include name="*.dll" />
				<include name="Db4oAdmin.exe" />
			</reference>
			
			<resource embed="true"				
				file="Db4oAdmin.Tests/Resources/CFNQSubject.cs"
				name="Db4oAdmin.Tests.Resources.CFNQSubject.cs" />
			
			<resource embed="true"				
				file="Db4oAdmin.Tests/Resources/PredicateSubject.cs"
				name="Db4oAdmin.Tests.Resources.PredicateSubject.cs" />

		</csc>
		
		<exec executable="${output.dir}/Db4oAdmin.Tests.exe"
			failonerror="true"
			dir="${output.dir}">
		</exec>
	</target>
	
	<target name="init">
		<mkdir dir="${output.dir}" />
		<copy todir="${output.dir}">
			<fileset dir="${dir.dist.dll.net}">
				<include name="*.dll" />
			</fileset>
		</copy>
		<copy todir="${output.dir}" file="../test/lib/Db4oUnit.dll" />
	</target>
	
	<target name="clean">
		<delete dir="${output.dir}" failonerror="false" />
	</target>
	
	<target name="rebuild" depends="clean, build">
	</target>
	
</project>