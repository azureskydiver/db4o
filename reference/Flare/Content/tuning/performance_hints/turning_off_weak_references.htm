<?xml version="1.0" encoding="utf-8"?><html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="6" MadCap:lastHeight="2958" MadCap:lastWidth="1029">
<head><title>Turning Off Weak References	<link href="../../Resources/Stylesheets/prettify.css" type="text/css" rel="stylesheet" />		<script type="text/javascript" src="../../Resources/Code/prettify.js"></script></title></head>
<body onload="prettyPrint()">
        <h1>Turning Off Weak References</h1>

<p MadCap:conditions="Primary.Java,Primary.All languages">
<p>Java: </p><p><code>Db4o.configure().weakReferences(false)</code></p>
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET">
<p>.NET: </p><p><code>Db4oFactory.Configure().WeakReferences(false)</code></p>
</p><p MadCap:conditions="Primary:net" /><a name="Advantage"></a><h2>Advantage</h2>
<p>will configure db4o to use hard direct references instead of weak references to control instantiated and stored objects.</p>

<a name="Effect"></a><h2>Effect</h2>
<p>A db4o database keeps a reference to all persistent objects that are currently held in RAM, whether they were stored to the database in this session or instantiated from the database in this session. This is how db4o can "know" than an object is to be updated: Any "known" object must be an update, any "unknown" object will be stored as "new". (Note that the reference system will only be in place as long as an <MadCap:snippetText src="../../Resources/Snippets/ObjectContainer.flsnp" /> is open. Closing and reopening an <MadCap:snippetText src="../../Resources/Snippets/ObjectContainer.flsnp" /> will clean the references system of the <MadCap:snippetText src="../../Resources/Snippets/ObjectContainer.flsnp" /> and all objects in RAM will be treated as "new" afterwards.) In the default configuration db4o uses weak references and a dedicated thread to clean them up after objects have been garbage collected by the VM. Weak references need extra ressources and the cleanup thread will have a considerable impact on performance since it has to be synchronized with the normal operations within the <MadCap:snippetText src="../../Resources/Snippets/ObjectContainer.flsnp" />. Turning off weak references will improve speed. </p>
<p>The downside: To prevent memory consumption from growing consistantly, the application has to take care of removing unused objects from the db4o reference system by itself. This can be done by calling</p>
<p MadCap:conditions="Primary.Java,Primary.All languages">
<p>Java: </p><p><code>ExtObjectContainer.purge(object)</code></p>
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET">
<p>.NET: </p>
<p><code>IExtObjectContainer.Purge(object)</code></p>
</p><p MadCap:conditions="Primary:net" />

<a name="Alternate Strategies"></a><h2>Alternate Strategies</h2>
<p MadCap:conditions="Primary.Java,Primary.All languages">
<p>Java: </p><p><code>ExtObjectContainer.purge(object)</code></p>
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET">
<p>.NET: </p><p><code>IExtObjectContainer.Purge(object)</code></p>
</p><p MadCap:conditions="Primary:net" />
<p>can also be called in normal weak reference operation mode to remove an object from the reference cache. This will help to keep the reference tree as small as possible. After calling #purge(object) an object will be unknown to the <MadCap:snippetText src="../../Resources/Snippets/ObjectContainer.flsnp" /> so this feature is also suitable for batch inserts. </p>    
  </body></html>