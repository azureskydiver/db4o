<?xml version="1.0" encoding="utf-8"?><html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="6" MadCap:lastHeight="2958" MadCap:lastWidth="1029">
<head><title>Custom Query Comparator	<link href="../../Resources/Stylesheets/prettify.css" type="text/css" rel="stylesheet" />		<script type="text/javascript" src="../../Resources/Code/prettify.js"></script></title></head>
<body onload="prettyPrint()">
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Custom Query Comparator</h1><p>Db4o allows using a custom comparator for query processing.
This can be useful for replacing the standard way of selecting query results,
for example, when a non-standard attribute type should be compared as string or
integer</p>

<p>The usage is best shown on an example. </p>

<p>Let's create a custom class containing string information:</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/MyString.java/MyString.java.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/MyString.cs/MyString.cs.flsnp" />
</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/MyString.vb/MyString.vb.flsnp" />
</p><p MadCap:conditions="Primary:vb" />

<p>MyString class will be used for an attribute in the
following class:</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/Record.java/Record.java.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/Record.cs/Record.cs.flsnp" />
</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/Record.vb/Record.vb.flsnp" />
</p><p MadCap:conditions="Primary:vb" />

<p>Let's save some Record objects to the database:</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.java/storeRecords.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.cs/StoreRecords.flsnp" />
</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.vb/StoreRecords.flsnp" />
</p><p MadCap:conditions="Primary:vb" />

<p>Selecting the query results, we need to compare string
values contained in MyString objects. This can be configured with the following
setting:</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.java/configure.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.cs/Configure.flsnp" />iv class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">CompareExample.cs: <span class="fscMemberName">MyStringAttribute</span></span></div><div class="fscCode"><pre ID=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> MyStringAttribute : IObjectAttribute
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Open_Text').style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Closed_Image').style.display='inline'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Closed_Text').style.display='inline';"/><img id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Closed_Text').style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Open_Image').style.display='inline'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Open_Text').style.display='inline';"/>        </span><span id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_59_322_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">object</span><span style="color: #000000;"> Attribute(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> original)
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Open_Text').style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Closed_Image').style.display='inline'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Closed_Text').style.display='inline';"/><img id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Closed_Text').style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Open_Image').style.display='inline'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Open_Text').style.display='inline';"/>            </span><span id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_126_312_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (original </span><span style="color: #0000FF;">is</span><span style="color: #000000;"> MyString)
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Open_Text').style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Closed_Image').style.display='inline'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Closed_Text').style.display='inline';"/><img id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Closed_Text').style.display='none'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Open_Image').style.display='inline'; document.getElementById('.ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Open_Text').style.display='inline';"/>                </span><span id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id=".ComparingCS.ZipsCompareExample.Cs_CompareExample.Cs_MyStringAttribute_1921_63_186_265_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                    </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> ((MyString)original).ToString();
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>                }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> original;
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>            }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>        }</span></span></div></pre></div></div>  </p>

</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.vb/Configure.flsnp" />iv class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">CompareExample.vb: <span class="fscMemberName">MyStringAttribute</span></span></div><div class="fscCode"><pre ID=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Open_Text').style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Closed_Image').style.display='inline'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Closed_Text').style.display='inline';"/><img id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Closed_Text').style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Open_Image').style.display='inline'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Open_Text').style.display='inline';"/><span style="color: #0000FF;">Private</span><span style="color: #000000;"> </span><span id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">Class MyStringAttribute</span><span id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_8_396_Open_Text"><span style="color: #0000FF;">Class</span><span style="color: #000000;"> MyStringAttribute
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">Implements</span><span style="color: #000000;"> IObjectAttribute
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Open_Text').style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Closed_Image').style.display='inline'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Closed_Text').style.display='inline';"/><img id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Closed_Text').style.display='none'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Open_Image').style.display='inline'; document.getElementById('.ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Open_Text').style.display='inline';"/>            </span><span style="color: #0000FF;">Public</span><span style="color: #000000;"> </span><span id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">Function Attribute()</span><span id=".ComparingVB.ZipsCompareExample.Vb_CompareExample.Vb_MyStringAttribute_2116_63_92_378_Open_Text"><span style="color: #0000FF;">Function</span><span style="color: #000000;"> Attribute(</span><span style="color: #0000FF;">ByVal</span><span style="color: #000000;"> original </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Object</span><span style="color: #000000;">) </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Object</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Implements</span><span style="color: #000000;"> IObjectAttribute.Attribute
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">If</span><span style="color: #000000;"> </span><span style="color: #0000FF;">TypeOf</span><span style="color: #000000;"> original </span><span style="color: #0000FF;">Is</span><span style="color: #000000;"> MyString </span><span style="color: #0000FF;">Then</span><span style="color: #000000;">
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                    </span><span style="color: #0000FF;">Return</span><span style="color: #000000;"> </span><span style="color: #0000FF;">CType</span><span style="color: #000000;">(original, MyString).ToString
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">End</span><span style="color: #000000;"> </span><span style="color: #0000FF;">If</span><span style="color: #000000;">
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">Return</span><span style="color: #000000;"> original
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>            </span><span style="color: #0000FF;">End Function</span></span><span style="color: #000000;">
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>        </span><span style="color: #0000FF;">End Class</span></span></div></pre></div></div>   </p>

</p><p MadCap:conditions="Primary:vb" /><p>This piece of code registers an attribute provider for
special query behavior. </p>

<p>The query processor will compare the
object returned by the attribute provider instead of the actual object, both
for the constraint and the candidate persistent object.</p>

<p>The querying code will look like this:</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.java/checkRecords.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.cs/CheckRecords.flsnp" />
</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../../Resources/Snippets/Custom Query Comparator/CompareExample.vb/CheckRecords.flsnp" />
</p><p MadCap:conditions="Primary:vb" />



<p>Using query comparator feature we can change the standard
way of selecting query results. This can be helpful for:</p>

<ul><li>querying user types using simple string or numeric
representation</li><li>encapsulating additional logic into querying algorithm.</li></ul>





</div>
    </div>
    
  <p>Download example code:</p>        <p></p></body></html>