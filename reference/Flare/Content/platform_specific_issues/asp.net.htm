<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="9" MadCap:lastHeight="8217" MadCap:lastWidth="1197" MadCap:conditions="Primary..NET,Primary.All languages" MadCap:ignoredWords="RandomAccessFileAdapter;randomAccessFileAdapter;NonFlushingIoAdapter;nonFlushingIoAdapter;CachedIoAdapter;cachedIoAdapter;disableCommitRecovery;DisableCommitRecovery;extObjectContainer;setSemaphore;getName;SetSemaphore;typeof;LOCK_;getID;GetID;getPilot;getSignature;idenity;car1;car2;car3;UUID;defragment;startsWith;getPoints;StartsWith;ExtentType;oql;AllPilots;OQLQuery;persistenceManager;newQuery;IList;IComparer;ObjectSet;IObjectSet;comparer;ExtObjectContainer;IExtObjectContainer;VB;pilot1;name1;name2;peekPersisted;isCached;JDO;WeakReferences;VM;ClientConfiguration;IClientConfiguration;BatchMessages;NO_OF_OBJECTS;maxBatchQueueSize;MaxBatchQueueSize;listResult;MessageRecipient;ObjectServer;openServer;ObjectNotStorableException;s;clientserverJava;ServerConfiguration;clientserverCS;cs;clientserverVB;vb;config;databaseFileName;int;NativeSocketFactory;socketFactory;OpenClient;hostName;IObjectServer;OpenServer;IConfiguration;INativeSocketFactory;IObjectContainer;genkey;SSLcert;storepass;SecureSocketFactory;IMessageSender;setMessageRecipient;SetMessageRecipient;IMessageRecipient;processMessage;ProcessMessage;ByVal;UpdateServer;waitMilliSeconds;releaseSemaphore;ReleaseSemaphore;monitorObject;semaphoreName;switchToFile;fileName;SwitchToFile;switchToMainFile;SwitchToMainFile;switchs;isAlive;IsAlive;replicateDeletions;ReplicateDeletions;GetType;g;ReplicationEvent;VersionNumbers;providerA;objectsChangedSinceLastReplication;ProviderA;ObjectsChangedSinceLastReplication;hbm;ProviderSignature;MySignature;PeerSignature;ReplicationProvider;HibernateReplicationProvider;ReplicationProviders;m;typed_id;pi2763;longPart;ObjectReference;className;typedId;Uuid;uuid;drs_providers;is_my_sig;t';f';drs_history;provider_id;PK;drs_objects;class_name;varchar;one_to_one;ReplicationConfigurator;SessionFactory;sessionFactory;buildSessionFactory;openSession;beginTransaction;createCriteria;AbstractDb4oTestCase;Db4oFixture;_fixture;AbstractSoloDb4oFixture;AbstractClientServerDb4oFixture;IDb4oFixture;IQuery;NewQuery;retrieveOnlyInstance;RetrieveOnlyInstance;countOccurences;CountOccurences;foreach;Visitor4;Foreach;IVisitor4;obj;deleteAll;DeleteAll;ReflectClass;reflectClass;indexField;fieldName;IndexField;Config;setUp;SetUp;db4oSetupBeforeStore;db4oSetupAfterStore;Db4oSetupBeforeStore;Db4oSetupAfterStore;runSoloAndClientServer;RunSoloAndClientServer;runSolo;RunSolo;runClientServer;RunClientServer;CodeBlock;Db4oUnit;ICodeBlock;isTrue;msg;IsTrue;bool;Msg;areEqual;AreEqual;FrameworkTestCase;runTestAndExpect;expFailures;RunTestAndExpect;ITest;GetConfig;storedType;runtimeType;tAlias;resolveRuntimeName;resolveStoredName;storedPattern;runtimePattern;aliasing;QueryStarted;QueryFinished;QueryEventArgs;ObjectEventArgs;CancellableObjectEventArgs;CommitEventArgs;client2;client1;WaitForCompletion;args;AddHandler;forObjectContainer;ForObjectContainer;OnCreated;createdEvent;onEvent;Event4;ABC0001DEF;MustInherit;CountedObject;IncrementedId;queryStarted;queryFinished;QueryStats;q;executionTime;activationCount;storedClass;Foo;classname;storedClasses;StoredClasses;getStoredFields;GetStoredFields;storedField;getParentStoredClass;GetParentStoredClass;reflectWith;Db4oFactory;ReflectWith;self_get;self_set;LoggingReflector;IoAdapter;MyEncryptionAdapter;Io;Db4oEnhancerMSBuildTask;SensorPanel;GetOptions;UsingTask;AssemblyFile;OutputPath;TaskName;ItemGroup;Db4oEnhance;TargetPath;AfterBuild;AbstractAssemblyInstrumentation;IAssemblyInstrumentation;TAInstrumentation;tp;EnhancementExample;tacustom;Db4oPersistent;typedef;classTargetDir;jarTargetDir;MaintenanceQueue;'Barrichello';'BMW';useIndexSystem;useRamSystem;discardSmallerThan;DiscardSmallerThan;allObjects;SumPilotPoints;SelectMinPointsPilot;AveragePilotPoints;CountSubGroups;SelectPilotsAndTrainees;SelectPilotsInRange;SelectAndChangePilots;SelectTestPilots6PointsMore;SelectPilots6To12Points;SelectPilotsRandom;SelectPilotsEven;SelectAnyOnePilot;SelectDistinctPilots;SelectAllPilots;SelectAllPilotsNonGeneric;GetSortedPilots;GetPilotsSortByNameAndPoints;GetPilotsSortWithComparator;SelectPilot5Points;SelectTestPilots;SelectPilotsNumberX6;newPackage;newClass;objectField;oldField;newField;newAssembly;ObjectField;aaplication">
    <head><title>ASP.NET	<link href="../Resources/Stylesheets/prettify.css" type="text/css" rel="stylesheet" /><script type="text/javascript" src="../Resources/Code/prettify.js"></script></title>
    </head>
    <body onload="prettyPrint()">
        <h1>
            <MadCap:keyword term="Web:ASP.NET" />ASP.NET</h1>
        <p>You can use db4o as a persistent layer of your ASP.NET application. The actual integration of db4o into your web application is quite simple: you just need to add reference to Db4objects.Db4o.dll and use it in a client/server mode.  </p><a name="Security Requirements "></a>
        <H2>Security Requirements </H2>
        <p>However, as it is characteristic to web-applications in general, there are some security permissions involved, which can in fact forbid db4o functionality in your ASP.NET application. So, before developing/deploying you should make sure that the required permissions would be granted to your application at the hosting server:</p>
        <OL>
            <LI>ASP.NET user should have read/write permissions to the directory containing database file. Obviously this is necessary to work with the database.</LI>
            <LI>
                <p>Trust Level of your site should be set to "Full".</p>
            </LI>
            <LI>
                <p>All the necessary permissions should be granted to db4o assembly. The easiest way to ensure this is to add full trust to db4o by installing it in GAC.</p>
            </LI>
            <p>If full trust is not a suitable solution for, you can check the minimum security permissions that db4o dll needs to operate using permcalc.exe tool from your Visual Studio installation. </p>
            <p><code>PermCalc.exe -Sandbox Db4objects.Db4o.dll</code>
            </p>
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/sandbox.PermCalc.xml/sandbox.PermCalc.xml.flsnp" />
            <p>Consult with your web-server administrator to grant these permissions. <a href="sandbox.permcalc.xml">permcalc.xml</a></p>
        </OL><a name="Sample Application"></a>
        <H2>Sample Application</H2>
        <OL>
        </OL>
        <p>Let's look at an example implementation: we will create a simple ASP.NET application, which will use db4o to store, retrieve and delete objects </p>
        <p>The basic requirements for seamless db4o integration are:</p>
        <UL>
            <LI>db4o server should open database file at application start and close it when application is terminated</LI>
            <LI>clients, accessing application through web-browser, should get their db4o-client connection on request.</LI>
        </UL>
        <p>In order to keep page-specific code clean we will implement db4o functionality in a separate Db4oHttpModule implementing IhttpModule interface.</p>
        <p>Database file path can be saved in <a href="web.config">Web.Config</a>: </p>
        <p><code>&lt;appSettings&gt;     &lt;add key="db4oFileName" value="~/Data/Test.yap"/&gt; &lt;/appSettings&gt;</code>
        </p>
        <p>Make sure that you have Data folder inside you web-site directory. ASPNET user should have enough rights to create and modify files inside this folder. You should also make sure that Data folder is not accessible to anonymous user; otherwise web-server visitors will be able to download your database.</p>
        <p>We will open db4o connection only with the first client request:</p>
        <p MadCap:conditions="Primary..NET,Primary.c#,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.cs/Client.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.cs/Server.flsnp" />
        </p>
        <p MadCap:conditions="Primary:cs" />
        <p MadCap:conditions="Primary..NET,Primary.VB.NET,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.vb/Client.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.vb/Server.flsnp" />
        </p>
        <p MadCap:conditions="Primary:vb" />
        <p>The following code will ensure that the database is closed upon termination:</p>
        <p MadCap:conditions="Primary..NET,Primary.c#,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.cs/Application_EndRequest.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.cs/Dispose.flsnp" />
            <p>
            </p>
        </p>
        <p MadCap:conditions="Primary:cs" />
        <p MadCap:conditions="Primary..NET,Primary.VB.NET,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.vb/Application_EndRequest.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.vb/Dispose.flsnp" />
        </p>
        <p MadCap:conditions="Primary:vb" />
        <p>This is basically all the functionality that is required from db4o module. In order to make use of it we need to register it in <a href="web.config">Web.Config</a>:</p>
        <p><code>&lt;httpModules&gt;       &lt;add type="Db4objects.Db4odoc.Web.Data.Db4oHttpModule" <a name="Db4oHttpModule"></a> /&gt; &lt;/httpModules&gt;</code>
        </p>
        <p>With the help of the created module we can access db4o database fairly easy:</p>
        <p MadCap:conditions="Primary..NET,Primary.c#,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Default.aspx.cs/SaveMessage.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Default.aspx.cs/RetrieveAll.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Default.aspx.cs/DeleteAll.flsnp" />
        </p>
        <p MadCap:conditions="Primary:cs" />
        <p MadCap:conditions="Primary..NET,Primary.VB.NET,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Default.aspx.vb/SaveMessage.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Default.aspx.vb/RetrieveAll.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Default.aspx.vb/DeleteAll.flsnp" />
        </p>
        <p MadCap:conditions="Primary:vb" />
        <p>To test the whole application you can use the following simple form: </p>
        <p MadCap:conditions="Primary..NET,Primary.c#,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/default.aspx/default.aspx.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/default.aspx.cs/default.aspx.cs.flsnp" />
        </p>
        <p MadCap:conditions="Primary:cs" />
        <p MadCap:conditions="Primary..NET,Primary.VB.NET,Primary.All languages">
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/default.aspx/default.aspx.flsnp" />
            <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/default.aspx.vb/default.aspx.vb.flsnp" />
        </p>
        <p MadCap:conditions="Primary:vb" /><a name="Persisting Objects in ASP.NET2 "></a>
        <H2>Persisting Objects in ASP.NET2 </H2>
        <p>If you are creating your application in ASP.NET2 you should take into consideration the fact that the assembly names are generated automatically on each build by default. Db4o distinguish persisted classes by name, namespace and assembly, so after the assembly name change, you won't be able to access classes saved with the previous version of the assembly.</p>
        <p>There are several workarounds:</p>
        <UL>
            <LI>You can create a separate class library keeping db4o logic and persistent classes. This can also help if you need to access fully trusted db4o library from partially trusted ASP application</LI>
            <LI>You can build your ASP.NET2 application manually using aspnet_compiler utility from .NET2 SDK.</LI>
            <p><code>aspnet_compiler.exe -v /WebSite -f -fixednames c:\WebSite -c -errorstack</code>
            </p>
            <p>Microsoft has published a how-to for <A class="" href="http://msdn.microsoft.com/en-us/library/ms228040.aspx">using the aspnet_compiler to generate fixed names for ASP.NET assemblies</A>.</p>
            <LI>You can use db4o aliasing API to redirect saved classes to the new assembly name. The following method should be called before opening database file to make all the classes within the namespace available after assembly name change:</LI>
            <p MadCap:conditions="Primary..NET,Primary.c#,Primary.All languages">
                <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.cs/ConfigureAlias.flsnp" />
            </p>
            <p MadCap:conditions="Primary:cs" />
            <p MadCap:conditions="Primary..NET,Primary.VB.NET,Primary.All languages">
                <MadCap:snippetBlock src="../Resources/Snippets/ASP.NET/Db4oHttpModule.vb/ConfigureAlias.flsnp" />
            </p>
            <p MadCap:conditions="Primary:vb" />
            <p>You can use TypeAlias for aliasing only specific class.</p>
        </UL><a name="More Information"></a>
        <H2>More Information</H2>
        <p>Additional information about using db4o in ASP.NET environment can be found in db4o <A href="http://developer.db4o.com/ProjectSpaces/view.aspx/All_Tools_and_Add-Ons">Project Spaces</A>. The following community projects featuring db4o ASP.NET membership providers exist:</p>
        <UL>
            <LI>
                <A href="http://www.codeplex.com/db4oProviders">db4o ASP.NET Providers</A>
            </LI>
            <LI>
                <A href="http://developer.db4o.com/ProjectSpaces/view.aspx/Db4oMembership_Provider">db4oMembershipProvider for ASP.NET2</A>
            </LI>
        </UL>
    </body>
</html>