<?xml version="1.0" encoding="utf-8"?><html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="6" MadCap:lastHeight="2958" MadCap:lastWidth="1029">
<head><title>Transaction	<link href="../Resources/Stylesheets/prettify.css" type="text/css" rel="stylesheet" />		<script type="text/javascript" src="../Resources/Code/prettify.js"></script></title></head>
<body onload="prettyPrint()">
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Transaction</h1><div id="TOC"><div id="TOCinner"><span class="TOCtitle">Contents</span><div class="TOCcontents"><ul><li><a href ="#Commit And Rollback">Commit And Rollback</a></li><li><a href ="#Refresh Live Objects">Refresh Live Objects</a></li></ul></li></ul></div></div></div>

<p>All work within db4o ObjectContainer is transactional. A transaction is implicitly started when you open a container, and the current transaction is implicitly committed when you close it again. db4o transaction is tied to  an open object container and only one transaction is allowed per object container instance. </p>
<a name="Commit And Rollback"></a><h2>Commit And Rollback</h2>
<p>You may choose to make a commit explicit or you may leave it for the <code>#close()</code> call:</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.java/storeCarCommit.flsnp" /><MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.java/listAllCars.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.cs/StoreCarCommit.flsnp" /><MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.cs/ListAllCars.flsnp" />
</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.vb/StoreCarCommit.flsnp" />div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">TransactionExample.vb: <span class="fscMemberName">ListAllCars</span></span></div><div class="fscCode"><pre ID=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">1</span><img id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Open_Text').style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Closed_Image').style.display='inline'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Closed_Text').style.display='inline';"/><img id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Closed_Text').style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Open_Image').style.display='inline'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Open_Text').style.display='inline';"/><span style="color: #0000FF;">Public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Shared</span><span style="color: #000000;"> </span><span id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">Sub ListAllCars()</span><span id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_1012_65_14_166_Open_Text"><span style="color: #0000FF;">Sub</span><span style="color: #000000;"> ListAllCars(</span><span style="color: #0000FF;">ByVal</span><span style="color: #000000;"> db </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IObjectContainer)
</span><span style="color: #008080;">2</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">Dim</span><span style="color: #000000;"> result </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IObjectSet </span><span style="color: #000000;">=</span><span style="color: #000000;"> db.Get(</span><span style="color: #0000FF;">GetType</span><span style="color: #000000;">(Car))
</span><span style="color: #008080;">3</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            ListResult(result)
</span><span style="color: #008080;">4</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>        </span><span style="color: #0000FF;">End Sub</span></span></div></pre></div></div>

</p><p MadCap:conditions="Primary:vb" />

<p>Before transaction is commited all the modifications to a database are written to a <a href="acid_model/acid_properties_for_db4o.html" class="wikiLink">temporary memory storage</a>. Commit (explicit or implicit) writes the modifications to the disk.</p>

<p>Please, remember to always commit or close your ObjectContainer when the work is done, to make sure that the data is saved to the permanent storage. <a href="../tuning/performance_hints/commit_strategies.html" class="wikiLink">Commit Strategies</a> contains some important information on when and how commit should be used to achieve the best performance. </p>

<p>If you do not want to save changes to the database, you can call rollback, resetting the state of our database to the last commit point.</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.java/storeCarRollback.flsnp" />div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">TransactionExample.java: <span class="fscMemberName">listAllCars</span></span></div><div class="fscCode"><pre ID=".TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">1</span><img id=".TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Open_Text').style.display='none'; document.getElementById('.TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Closed_Image').style.display='inline'; document.getElementById('.TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Closed_Text').style.display='inline';"/><img id=".TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Closed_Text').style.display='none'; document.getElementById('.TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Open_Image').style.display='inline'; document.getElementById('.TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Open_Text').style.display='inline';"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> listAllCars(ObjectContainer container) </span><span id=".TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id=".TransactionsJava.ZipsTransactionExample.Java_TransactionExample.Java_ListAllCars_1926_69_59_145_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">2</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        ObjectSet result</span><span style="color: #000000;">=</span><span style="color: #000000;">container.get(Car.</span><span style="color: #0000FF;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;">3</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        listResult(result);
</span><span style="color: #008080;">4</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>    }</span></span></div></pre></div></div>

</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.cs/StoreCarRollback.flsnp" />div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">TransactionExample.cs: <span class="fscMemberName">ListAllCars</span></span></div><div class="fscCode"><pre ID=".TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">1</span><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> ListAllCars(IObjectContainer db)
</span><span style="color: #008080;">2</span><span style="color: #000000;"><img id=".TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Open_Text').style.display='none'; document.getElementById('.TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Closed_Image').style.display='inline'; document.getElementById('.TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Closed_Text').style.display='inline';"/><img id=".TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Closed_Text').style.display='none'; document.getElementById('.TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Open_Image').style.display='inline'; document.getElementById('.TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Open_Text').style.display='inline';"/>        </span><span id=".TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id=".TransactionsCS.ZipsTransactionExample.Cs_TransactionExample.Cs_ListAllCars_2132_65_61_157_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">3</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            IObjectSet result </span><span style="color: #000000;">=</span><span style="color: #000000;"> db.Get(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(Car));
</span><span style="color: #008080;">4</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            ListResult(result);
</span><span style="color: #008080;">5</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>        }</span></span></div></pre></div></div>

</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.vb/StoreCarRollback.flsnp" />div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">TransactionExample.vb: <span class="fscMemberName">ListAllCars</span></span></div><div class="fscCode"><pre ID=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">1</span><img id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Open_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Open_Text').style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Closed_Image').style.display='inline'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Closed_Text').style.display='inline';"/><img id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Closed_Image" src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Closed_Text').style.display='none'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Open_Image').style.display='inline'; document.getElementById('.TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Open_Text').style.display='inline';"/><span style="color: #0000FF;">Public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Shared</span><span style="color: #000000;"> </span><span id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">Sub ListAllCars()</span><span id=".TransactionsVB.ZipsTransactionExample.Vb_TransactionExample.Vb_ListAllCars_2334_65_14_166_Open_Text"><span style="color: #0000FF;">Sub</span><span style="color: #000000;"> ListAllCars(</span><span style="color: #0000FF;">ByVal</span><span style="color: #000000;"> db </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IObjectContainer)
</span><span style="color: #008080;">2</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">Dim</span><span style="color: #000000;"> result </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IObjectSet </span><span style="color: #000000;">=</span><span style="color: #000000;"> db.Get(</span><span style="color: #0000FF;">GetType</span><span style="color: #000000;">(Car))
</span><span style="color: #008080;">3</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            ListResult(result)
</span><span style="color: #008080;">4</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>        </span><span style="color: #0000FF;">End Sub</span></span></div></pre></div></div>

</p><p MadCap:conditions="Primary:vb" />
<a name="Refresh Live Objects"></a><h2>Refresh Live Objects</h2>
<p>There is one thing that you should remember when rolling back: the <code>#rollback()</code> method will cancel the modifications, but it won't change back the state of the objects in your reference cache.</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.java/carSnapshotRollback.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.cs/CarSnapshotRollback.flsnp" />
</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.vb/CarSnapshotRollback.flsnp" />
</p><p MadCap:conditions="Primary:vb" />

<p>You have to explicitly refresh your live objects when their state might become different from the state in the database:</p>

<p MadCap:conditions="Primary.Java">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.java/carSnapshotRollbackRefresh.flsnp" />
</p><p MadCap:conditions="Primary:java" />

<p MadCap:conditions="Primary..NET,Primary.c#">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.cs/CarSnapshotRollbackRefresh.flsnp" />
</p><p MadCap:conditions="Primary:cs" />

<p MadCap:conditions="Primary..NET,Primary.VB.NET">

<MadCap:snippetBlock src="../Resources/Snippets/Transaction/TransactionExample.vb/CarSnapshotRollbackRefresh.flsnp" />
</p><p MadCap:conditions="Primary:vb" />

<p>The <code>#refresh()</code> method might be also helpful when the changes to the database are done from different threads. See <a href="../client-server.html" class="wikiLink">Client-Server</a> for more information.</p></div>
    </div>
    
  <p>Download example code:</p>        <p></p></body></html>