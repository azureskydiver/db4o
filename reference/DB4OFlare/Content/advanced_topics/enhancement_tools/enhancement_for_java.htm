<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="5" MadCap:lastHeight="767" MadCap:lastWidth="482" MadCap:conditions="Primary.Java,Primary.All languages">
    <head>
    </head>
    <body>
        <h1>
            <MadCap:keyword term="Instrumentation" />Enhancement For Java</h1>
        <div MadCap:conditions="Primary.Java">
            <p>The db4o enhancement framework relies on the following jars:</p>
            <table border="1" cellpadding="0" cellspacing="0">
                <tr>
                    <td valign="top">
                        <p>bloat-1.0.jar</p>
                    </td>
                    <td valign="top">
                        <p>Third-party bytecode instrumentation library</p>
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <p>db4o-<MadCap:variable name="Primary.CurrentVersion"></MadCap:variable>-instrumentation</p>
                    </td>
                    <td valign="top">
                        <p>Instrumentation library on top of bloat</p>
                    </td>
                </tr>
                <tr>
                    <td valign="top">
                        <p>db4o-<MadCap:variable name="Primary.CurrentVersion"></MadCap:variable>-tools</p>
                    </td>
                    <td valign="top">
                        <p>Enhancement and other utilities</p>
                    </td>
                </tr>
            </table>
            <p>In addition: </p>
            <ul>
                <li>For TA
					/TP instrumentation enhancement db4o-<MadCap:variable name="Primary.CurrentVersion"></MadCap:variable>-taj.jar should be used (contains TA
				/TP instrumentation classes).</li>
                <li>For
					NQ optimization db4o-<MadCap:variable name="Primary.CurrentVersion" />-nqopt.jar is used (provides instrumentation
				functionality for NQ).</li>
            </ul>
        </div>
        <p>The basic steps required to enhance classes are:</p>
        <ol>
            <li>Create a
     ClassFilter instance to select the classes for enhancement. ClassFilter is
     an interface in db4oinstrumentation project and is implemented by several
     classes, like AcceptAllClassesFilter, ByNameClassFilter and others.</li>
            <li>Create
     BloatClassEdit array of classes capable of editing class bytecode.
     BloatClassEdit is an interface in db4oinstrumentation project. Among its
     implementations are TranslateNQToSODAEdit (implements NQ optimization) and
     InjectTransparentActivationEdit (injects TA/TP awareness). Filter can be used
     in some of the edit classes (InjectTransparentActivationEdit).</li>
            <li>For
     load-time instrumentation the edit classes created above are passed to
     Db4oInstrumentationLauncher together with the application entry point
     class. Db4oInstrumentationLauncher is a public class in db4oinctrumentation project, which creates a special instrumenting classloader and uses it to
     load the application's main class.</li>
            <li>For
     build time instrumentation Db4oFileEnhancerAntTask is used to create an
     enhancer task in Ant, which must call the class edit classes inside.
     Db4oFileEnhancerAntTask is a class extending Ant task in db4oinstrumentation project. It loads and instruments the classes using class edits supplied
     as parameters to the enhancer task and copies the resulted classes to the
     output directory. It can also work on Jars instead of classes.</li>
        </ol>
        <p>The examples below shows how enhancer works at load and
build time:</p>
        <ul>
            <li><a href="../enhancement_tools.htm">Simplest Enhancement Script</a>
            </li>
            <li><a href="../../basics/transparentpersistence/ta_enhanced_example/ta_enhancement_at_load_time.htm">TA Enhancement at Loading Time</a>
            </li>
            <li><a href="../../basics/querying/native_queries/native_query_optimization/nq_build_time_optimisation.htm">NQ Enhancement at Build Time</a>
            </li>
        </ul>
    </body>
</html>