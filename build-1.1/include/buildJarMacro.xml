<project name="buildJarMacro" basedir="." default="">
	<macrodef name="resetDir">
		<attribute name="dir" />
		<sequential>
			<delete dir="@{dir}" failonerror="true"/>
			<mkdir dir="@{dir}" />
		</sequential>
	</macrodef>

	<path id="emptyClassPath"/>
	<macrodef name="buildjar" description="javac, copy xml files in src then jar">
		<attribute name="srcDir"/>
		<attribute name="jarPath"/>
		
		<attribute name="compileIncludes" default="**"/>
		<attribute name="compileExcludes" default=""/>
		
		<attribute name="classPathRefId" default="emptyClassPath"/>
		<attribute name="include" default="**/*.xml"/>
		<attribute name="exclude" default=""/>
		
		<attribute name="compiler" default="modern"/>
		<attribute name="fork" default="no"/>
		<attribute name="executable"  default="javac"/>
		
		<attribute name="debug" default="off"/>
		<attribute name="target" default="1.5"/>
		<attribute name="source" default="1.5"/>
		<attribute name="encoding" default="UTF-8"/>
		
		<attribute name="compilerArg"  default=""/>
		
		<sequential>
			<property name="temp.dir" value="${tempOne}" />
			
			<resetDir dir="${temp.dir}"/>

			<javac 
				srcdir="@{srcDir}" 
				destdir="${temp.dir}"
				compiler="@{compiler}"
				fork="@{fork}"
				executable="@{executable}"
				debug="@{debug}"
				target="@{target}"
				source="@{source}"
				encoding="@{encoding}"	
				includes="@{compileIncludes}"		
				excludes="@{compileExcludes}"		
			>
				<classpath refid="@{classPathRefId}" />
				<compilerarg line="@{compilerArg}"/>
			</javac>
			
			<copy todir="${temp.dir}">
				<fileset dir="@{srcDir}">
					<exclude name="@{exclude}" />
					<include name="@{include}" />
				</fileset>
			</copy>
			
			<jar jarfile="@{jarPath}" basedir="${temp.dir}" />
			
			<delete dir="${temp.dir}" failonerror="true"/>
		</sequential>
	</macrodef>
</project>