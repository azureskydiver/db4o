<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>The Translator API</title>
    <link rel="stylesheet" type="text/css" href="../../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>The Translator API</h1><div id="TOC"><div id="TOCinner"><span class="TOCtitle">Contents</span><div class="TOCcontents"><ul><li><a href ="#ObjectTranslator">ObjectTranslator</a></li><li><a href ="#ObjectConstructor">ObjectConstructor</a></li></ul></li></ul></div></div></div>
<p></p>

<p>So how do we get our object into the database, now that everything seems&nbsp;to fail? Db4o provides a way to specify a custom way of storing and retrieving&nbsp;objects through the ObjectTranslator and ObjectConstructor interfaces.</p>
<a name="ObjectTranslator"></a><h4><span>ObjectTranslator</span></h4><span>The ObjectTranslator API looks like this:<br />
</span>
<span class="java">Java: <br />
public Object onStore(ObjectContainer container,Object applicationObject);<br />
public void onActivate(ObjectContainer container,Object applicationObject,Object storedObject);<br />
public Class storedClass ()[filter]<br />
<span class="net">.NET: <br />
public Object OnStore(ObjectContainer container,Object applicationObject);<br />
public void OnActivate(ObjectContainer container,Object applicationObject,Object storedObject);<br />
public Class StoredClass ()[filter]<br />

The usage is quite simple: When a translator is configured for a class,&nbsp;db4o will call its onStore method with a reference to the database and&nbsp;the instance to be stored as a parameter and will store the object returned.&nbsp;This object's type has to be primitive from a db4o point of view and it has&nbsp;to match the type specification returned by storedClass().<br />
<br />
On retrieval, db4o will create a blank object of the target class (using&nbsp;the configured instantiation method) and then pass it on to onActivate()&nbsp;along with the stored object to be set up accordingly.
<p>&nbsp;</p>
<a name="ObjectConstructor"></a><h4 class="CommonTitle"><span>ObjectConstructor</span></h4>
<p><span>However, this will only work if the application object's class provides&nbsp;sufficient setters to recreate its state from the information contained&nbsp;in the stored object, which is not the case for our example class.<br />
<br />
For these cases db4o provides an extension to the ObjectTranslator&nbsp;interface, ObjectConstructor, which declares one additional method:</span></p>
<p><span class="java">Java: public Object onInstantiate(ObjectContainer container,Object storedObject);</span><br /></p>
<p><span class="net">.NET: public Object OnInstantiate(ObjectContainer container,Object storedObject);</span><br /></p>
If db4o detects a configured translator to be an ObjectConstructor&nbsp;implementation, it will pass the stored class instance to the onInstantiate()&nbsp;method and use the result as a blank application object to be processed&nbsp;by onActivate().<br />
<br />
Note that, while in general configured translators are applied to&nbsp;subclasses, too, ObjectConstructor application object instantiation&nbsp;will not be used for subclasses (which wouldn't make much sense,&nbsp;anyway), so ObjectConstructors have to be configured for the&nbsp;concrete classes.
<style>
.net{display:none;}
</style>
</div>
    </div>
    <div id="footer">
					This revision (5) was last Modified 2006-11-04T20:00:40 by Tetyana.
				</div>
  </body>
</html>