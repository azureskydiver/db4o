<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Sharpen Set-Up For Db4o Build</title>
    <link rel="stylesheet" type="text/css" href="../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Sharpen Set-Up For Db4o Build</h1><div id="TOC"><div id="TOCinner"><span class="TOCtitle">Contents</span><div class="TOCcontents"><ul><li><a href ="#Conversion Scope">Conversion Scope</a></li><li><a href ="#Naming">Naming</a></li></ul></li></ul></div></div></div><script>
//We attach this function to a browser object as a variable so that if multiple of these blocks are
//present on the same page, then they will simply over-write eachother with the same function instead
//of generating a naming collision.
window.WikiCodeFormattingCopyToClipboard = function copyToClipboard(sID){
	var sContent = document.getElementById(sID).innerText;
	if( window.clipboardData && clipboardData.setData )
	{
		clipboardData.setData("Text", sContent);
	}
	else
	{
		alert("You must enable javascript access to your clipboard for this feature to work. Please referr to your browser documentation or Google search for instructions.");
	}
}
</script>


<p>Sharpen is used to translate Java version of db4o to c#. The
basic process is defined in <b>sharpen-all</b>
target of <b>db4obuild\build-dotnet.xml</b>.
In the primitive case defining sharpen task and applying it to java source
should be enough:</p>

<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">Sharpen.Xml</span></div><div class="fscCode"><pre ID="ResourcesReferenceWorking_With_Source_CodeSharpen_Set-Up_For_Db4o_Buildsharpen.Xml_266_25"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> Define sharpen task</span><span style="color: #008000;">--&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>  </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">macrodef </span><span style="color: #FF0000;">name</span><span style="color: #0000FF;">=&quot;sharpen&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">attribute </span><span style="color: #FF0000;">name</span><span style="color: #0000FF;">=&quot;workspace&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">attribute </span><span style="color: #FF0000;">name</span><span style="color: #0000FF;">=&quot;resource&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">element </span><span style="color: #FF0000;">name</span><span style="color: #0000FF;">=&quot;args&quot;</span><span style="color: #FF0000;"> optional</span><span style="color: #0000FF;">=&quot;yes&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">sequential</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>      </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">echo</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">java -cp ${eclipse.startup.jar} org.eclipse.core.launcher.Main -data @{workspace} -application sharpen.core.application @{resource}</span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">echo</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>      </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">exec </span><span style="color: #FF0000;">executable</span><span style="color: #0000FF;">=&quot;${file.jvm.jdk1.5}&quot;</span><span style="color: #FF0000;"> failonerror</span><span style="color: #0000FF;">=&quot;true&quot;</span><span style="color: #FF0000;"> timeout</span><span style="color: #0000FF;">=&quot;1800000&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;-Xms256m&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;-Xmx512m&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;-cp&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;${eclipse.startup.jar}&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;org.eclipse.core.launcher.Main&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">16</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;-data&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">file</span><span style="color: #0000FF;">=&quot;@{workspace}&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;-application&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;sharpen.core.application&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">20</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;-header&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">21</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">file</span><span style="color: #0000FF;">=&quot;${dir.config}/copyright_comment.txt&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">22</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">arg </span><span style="color: #FF0000;">value</span><span style="color: #0000FF;">=&quot;@{resource}&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">23</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        
</span><span style="color: #008080;">24</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">args </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">25</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>        
</span><span style="color: #008080;">26</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>      </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">exec</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">27</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">sequential</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">28</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>  </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">macrodef</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008080;">29</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>
</span><span style="color: #008080;">30</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>    </span><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> Call sharpen to convert db4oj/core/src into dist.sharpen </span><span style="color: #008000;">--&gt;</span><span style="color: #000000;"> 
</span><span style="color: #008080;">31</span><span style="color: #000000;"><img src="../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/>  </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">sharpen </span><span style="color: #FF0000;">workspace</span><span style="color: #0000FF;">=&quot;dist.sharpen&quot;</span><span style="color: #FF0000;"> resource</span><span style="color: #0000FF;">=&quot;db4oj/core/src&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span></div></pre></div></div>

<p>However, the complexity of the translation requires some
fine tuning. Let's look at the options and annotations used to make db4o
conversion working and produce a reasonable result.</p><a name="Conversion Scope"></a><h2>Conversion Scope</h2>

<p>Though Sharpen provides rather sophisticated framework, some
of the java language structures cannot be translated to c# without losing some
of the readability and nativeness of the c# code. One of the examples is IO
API. In these cases a full c# class is re-written manually. These classes are
excluded from the conversion by using @sharpen.ignore annotation. However this
solves only half of the problem, because the manually-translated classes still
should be placed correctly in the corresponding namespaces. This is achieved by
creating a c# project structure containing only manually translated classes.
The result of the sharpening is then copied into this structure, resulting in a
full and valid c# project.</p><a name="Naming"></a><h2>Naming</h2>

<p>Naming conventions differ for java and c#, but db4o code
should look native in both environments. There are several options that help to
achieve this:</p>

<p><code>-pascalCase+</code> - enforces Pascal case for identifies and
namespaces</p>

<p><code>-nativeTypeSystem</code> - use .NET typesystem</p>

<p><code>-nativeInterfaces</code> - add "I" in front of the interface name</p>

<p>Sharpen options also include different re-namings to make c#
names look more natural:</p>

<p><code>-typeMapping com.db4o.Db4o Db4objects.Db4o.Db4oFactory</code></p>

<p><code>-namespaceMapping com.db4o Db4objects.Db4o</code></p>

<p>and others.</p>

<p>c# supports a concept of type properties whereas Java getter
and setter methods are used. To convert those properly propertyMapping option
is defined:</p>

<p><code>-propertyMapping com.db4o.foundation.Iterator4.current
Current</code></p><p>For more information on these and other options see <a href="../sharpen/sharpen_command-line_arguments.html" class="wikiLink">Sharpen Command-Line Arguments</a>.</p></div>
    </div>
    <div id="footer">
					This revision (2) was last Modified 2008-05-18T17:17:33 by Tetyana.
				</div>
  </body>
</html>