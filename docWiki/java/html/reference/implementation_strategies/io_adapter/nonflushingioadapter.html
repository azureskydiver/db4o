<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>NonFlushingIoAdapter</title>
    <link rel="stylesheet" type="text/css" href="../../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>NonFlushingIoAdapter</h1><script>
//We attach this function to a browser object as a variable so that if multiple of these blocks are
//present on the same page, then they will simply over-write eachother with the same function instead
//of generating a naming collision.
window.WikiCodeFormattingCopyToClipboard = function copyToClipboard(sID){
	var sContent = document.getElementById(sID).innerText;
	if( window.clipboardData && clipboardData.setData )
	{
		clipboardData.setData("Text", sContent);
	}
	else
	{
		alert("You must enable javascript access to your clipboard for this feature to work. Please referr to your browser documentation or Google search for instructions.");
	}
}
</script>

<p>NonFlushingIoAdapter is a special IO Adapter, which can be used to improve commit performance. Commit is a complex operation and requires <a href="../../basic_concepts/acid_model/acid_properties_for_db4o.html" class="wikiLink">flushing to the hard drive</a> after each stage of commit. This is necessary as most operating system try to avoid the overhead of disk access by
caching disk write data and only flushing the resulting changes to the
disk. In the case of db4o commit it would mean that the physical write of some commit stages will be partially skipped and the data will be irreversibly lost. <br></p><p>However, physical access to the hard drive is a time-consuming operation and may considerably affect the performance.&nbsp; That is where NonFlushingIoAdapter comes in: it allows the operating system to keep commit data in cache and do the physical writes in a most performant order. This may sound very nice, but in fact a system shutdown while the commit data is still in cache will lead to the database corruption.</p>
<p>The following example shows how to use the NonFlushingIoAdapter. You can run it and see the performance improvement on commit stage:</p>
<span name="cs_wiki_filter" csw_filters="java">
<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">IOExample.java: <span class="fscMemberName">testNonFlushingAdapter</span></span></div><div class="fscCode"><pre ID="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Open_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Closed_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Closed_Text').style.display='inline';"/><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Closed_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Open_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Open_Text').style.display='inline';"/><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> testNonFlushingAdapter()</span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_44_1278_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> File(DB4O_FILE_NAME).delete();
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    RandomAccessFileAdapter randomAccessFileAdapter </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> RandomAccessFileAdapter();
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    NonFlushingIoAdapter nonFlushingIoAdapter </span><span style="color: #000000;">=</span><span style="color: #000000;"> 
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                                     </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> NonFlushingIoAdapter(randomAccessFileAdapter);
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    CachedIoAdapter cachedIoAdapter </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> CachedIoAdapter(nonFlushingIoAdapter);
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    Configuration configuration </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.newConfiguration();
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    configuration.io(cachedIoAdapter);
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    ObjectContainer container </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.openFile(configuration, DB4O_FILE_NAME);
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Open_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Closed_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Closed_Text').style.display='inline';"/><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Closed_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Open_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Open_Text').style.display='inline';"/>    </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_554_831_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      Pilot pilot </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Pilot(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Rubens Barrichello</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.store(pilot);
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      </span><span style="color: #0000FF;">long</span><span style="color: #000000;"> startTime </span><span style="color: #000000;">=</span><span style="color: #000000;"> System.currentTimeMillis();
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.commit();
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Commit time with NonFlushingIoAdapter: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> 
</span><span style="color: #008080;">16</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          (System.currentTimeMillis() </span><span style="color: #000000;">-</span><span style="color: #000000;"> startTime) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> ms.</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Open_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Closed_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Closed_Text').style.display='inline';"/><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Closed_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Open_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Open_Text').style.display='inline';"/>    }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_840_867_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.close();
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>    }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">20</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    
</span><span style="color: #008080;">21</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    </span><span style="color: #008000;">//
</span><span style="color: #008080;">22</span><span style="color: #008000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/></span><span style="color: #000000;">    </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> File(DB4O_FILE_NAME).delete();
</span><span style="color: #008080;">23</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>    container </span><span style="color: #000000;">=</span><span style="color: #000000;"> Db4o.openFile(DB4O_FILE_NAME);
</span><span style="color: #008080;">24</span><span style="color: #000000;"><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Open_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Closed_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Closed_Text').style.display='inline';"/><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Closed_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Open_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Open_Text').style.display='inline';"/>    </span><span style="color: #0000FF;">try</span><span style="color: #000000;"> </span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_964_1239_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">25</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      Pilot pilot </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Pilot(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Rubens Barrichello</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">26</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.store(pilot);
</span><span style="color: #008080;">27</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      </span><span style="color: #0000FF;">long</span><span style="color: #000000;"> startTime </span><span style="color: #000000;">=</span><span style="color: #000000;"> System.currentTimeMillis();
</span><span style="color: #008080;">28</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.commit();
</span><span style="color: #008080;">29</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      System.out.println(</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Commit time with default IO Adapter: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">+</span><span style="color: #000000;"> 
</span><span style="color: #008080;">30</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>          (System.currentTimeMillis() </span><span style="color: #000000;">-</span><span style="color: #000000;"> startTime) </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> ms.</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);
</span><span style="color: #008080;">31</span><span style="color: #000000;"><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Open_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Closed_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Closed_Text').style.display='inline';"/><img id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Closed_Text').style.display='none'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Open_Image').style.display='inline'; document.getElementById('..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Open_Text').style.display='inline';"/>    }</span></span><span style="color: #000000;"> </span><span style="color: #0000FF;">finally</span><span style="color: #000000;"> </span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IosJava.ZipsIOExample.Java_IOExample.Java_TestNonFlushingAdapter_1207_62_1248_1275_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">32</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>      container.close();
</span><span style="color: #008080;">33</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>    }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">34</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>  }</span></span></div></pre></div></div>&nbsp;</p>
</span>


<p>Please, remember, that NonFlushingIoAdapter is potentially dangerous and any unexpected system shutdown may corrupt your database. Use with caution and avoid using in production environments.&nbsp;</p>

</div>
    </div>
    <div id="footer">
					This revision (2) was last Modified 2008-06-30T15:52:37 by Tetyana.
				</div>
  </body>
</html>