<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Two Freespace Systems</title>
    <link rel="stylesheet" type="text/css" href="../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Two Freespace Systems</h1><p>&nbsp;</p>
<p>db4o comes with two freespace systems, one holds all freespace information in RAM, the other uses the&nbsp;internal indexing architecture. You can configure db4o to use either of the two by calling&nbsp;</p>
<p><span class="java">Java: Db4o.configure().freespace().useRamSystem() </span><br /></p>
<p><span class="net">.NET: Db4o.Configure().Freespace().UseRamSystem() </span><br /></p>
<p>or</p>
<p><span class="java">Java: Db4o.configure().freespace().useIndexSystem() </span><br /></p>
<p><span class="net">.NET: Db4o.Configure().Freespace().UseIndexSystem() </span><br /></p>
<br />
This call should be made before you open the database for the first time<br />
By default db4o uses <strong>RAM freespace management system</strong>. The information about free slots is loaded into&nbsp;memory on opening a database file and discarded on closing it. This system is quite fast, but it has its downside:<br />
<br />
1)&nbsp;&nbsp;&nbsp;&nbsp;Higher RAM usage during operation.<br />
2)&nbsp;&nbsp;&nbsp;&nbsp;Loss of freespace upon abnormal termination. That is done for security reasons and freespace can be&nbsp;reclaimed using defragmentation.<br />
<br />
RAM-based freespace management is a good performance solution, but it can be insufficient for the systems&nbsp;with limited RAM resources and high probability of abnormal system termination (power failure on mobile devices).<br />
In order to meet the requirements of such environments new <strong>index-based freespace management system</strong>&nbsp;was built. It solves the problems of RAM-based system:<br />
<br />
1)&nbsp;&nbsp;&nbsp;&nbsp;RAM usage is kept at the minimum, as the system always operates from file.<br />
2)&nbsp;&nbsp;&nbsp;&nbsp;No freespace is lost on abnormal system termination (database file won't grow unnecessarily).<br />
<br />
How it works?:<br />
-&nbsp;&nbsp;&nbsp;&nbsp;The system uses existing index functionality to keep information about available freespace<br />
-&nbsp;&nbsp;&nbsp;&nbsp;Index operates against the file, not against memory<br />
-&nbsp;&nbsp;&nbsp;&nbsp;For every new write to the database file the system tries to find a freed slot, which is at least the size needed&nbsp;or greater, traversing freespace index<br />
-&nbsp;&nbsp;&nbsp;&nbsp;When an object is updated or deleted, its 'old' slot is added to the freespace index<br />
-&nbsp;&nbsp;&nbsp;&nbsp;This index system is transactional (no information is lost upon abnormal system termination)<br />
-&nbsp;&nbsp;&nbsp;&nbsp;It stores diffs in a tree in RAM (index add/remove) together with nodes that represent parts or the whole index, as it exists in the file.<br />
<br />
Index-based freespace system can show poorer performance compared to RAM-based system, as file access&nbsp;for index traversal it comparatively slow. <br />
However, index-based freespace system can be a reasonable solution for mobile devices, where file access&nbsp;is not much slower than RAM-access, and ACID transactions together with low memory consumption are&nbsp;most valuable factors.<br /><style>
.net{display:none;}
</style>
</div>
    </div>
    <div id="footer">
					This revision (5) was last Modified 2006-11-04T16:49:21 by Tetyana.
				</div>
  </body>
</html>