<?xml version="1.0"?>
<project name="common build definitions">
	<property environment="env" />
	<property file="machine.properties" />
	<property file="ant.properties" />
	
	<taskdef name="filehead" classname="com.db4o.devtools.ant.FileHeadAntTask">
		<classpath>
			<pathelement location="${dir.build.bin}" />
			<path path="${path.classpath.full}" />
		</classpath>
	</taskdef>
	
	<taskdef name="updatecsharpproject" classname="com.db4o.devtools.ant.UpdateCSharpProjectAntTask">
		<classpath>
			<pathelement location="${dir.build.bin}" />
			<path path="${path.classpath.full}" />
		</classpath>
	</taskdef>
	
	<taskdef name="updateAssemblyHintPath" classname="com.db4o.devtools.ant.UpdateAssemblyHintPath">
		<classpath>
			<pathelement location="${dir.build.bin}" />
			<path path="${path.classpath.full}" />
		</classpath>
	</taskdef>
	
	<macrodef name="sharpen">
		<attribute name="workspace" />
		<attribute name="resource" />
		
		<element name="args" optional="yes" />
		
		<sequential>
			<java jvm="${file.jvm.jdk1.5}" classname="org.eclipse.core.launcher.Main" fork="yes" failonerror="true">
				<classpath>
					<pathelement location="${eclipse.home}/startup.jar" />
				</classpath>
					
				<arg value="-data" />
				<arg file="@{workspace}" />
				<arg value="-application" />
				<arg value="javatocsharp.core.application" />
				<arg value="@{resource}" />
				
				<args />
					
			</java>
		</sequential>
	</macrodef>
	
	<target name="install-javatocsharp-plugin">
			
		<property name="javatocsharp.core.dir" location="../javatocsharp.core" />
		
		<mkdir dir="${javatocsharp.core.dir}/bin" />
		
		<echo>${eclipse.home}/plugins</echo>
		<javac debug="true" source="1.5" destdir="${javatocsharp.core.dir}/bin" srcdir="${javatocsharp.core.dir}/src">
			<classpath>
				<fileset dir="${eclipse.home}/plugins">
					<include name="org.eclipse.osgi_*/osgi.jar" />
					<include name="org.eclipse.core.resources_*/resources.jar" />
					<include name="org.eclipse.core.runtime_*/runtime.jar" />
					<include name="org.eclipse.jdt.core_*/jdtcore.jar" />
					<!-- redundant entries: in newer eclipse installs those reside in jars -->
					<include name="org.eclipse.osgi_*.jar" />
					<include name="org.eclipse.core.resources_*.jar" />
					<include name="org.eclipse.core.runtime_*.jar" />
					<include name="org.eclipse.jdt.core_*.jar" />
				</fileset>
			</classpath>
		</javac>
		
		<property name="plugin.dir" value="${plugins.home}/javatocsharp.core_1.0.0" />
		<delete dir="${plugin.dir}" />
		<mkdir dir="${plugin.dir}" />
		<jar destfile="${plugin.dir}/javatocsharp.jar" basedir="${javatocsharp.core.dir}/bin" />
		<copy todir="${plugin.dir}" file="${javatocsharp.core.dir}/plugin.xml" />

	</target>

</project>