<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="stylesheet" type="text/css" href="docs.css">
</head>
<body><div id="pagecontainer"><table><tr><td width="5">&nbsp;</td><td><a name="Messaging"></a><br>
<a name="outline564"></a><br><h1>21. Messaging</h1><br>
In client/server mode the TCP connection between the client&nbsp;and the server can also be used to send messages from the&nbsp;client to the server.<br>
<br>
Possible usecases could be:<br>
- shutting down and restarting the server<br>
- triggering server backup<br>
- using a customized login strategy to restrict the number&nbsp;of allowed client connections<br>
<br>
Here is some example code how this can be done.<br>
<br>
First we need to decide on a class that we want to use as the&nbsp;message. Any object that is storable in db4o can be used as&nbsp;a message, but strings and other simple types will not be&nbsp;carried (as they are not storable in db4o on their own). Let's&nbsp;create a dedicated class:<br>
<br>
<table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td class="lg">
<code>class MyClientServerMessage {<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;private String info;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;public MyClientServerMessage(String info){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.info = info;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;public Strint toString(){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "MyClientServerMessage: " + info;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
}<br>
</code></td></tr></table>
<br>
<br>
Now we have to add some code to the server to react to arriving&nbsp;messages. This can be done by configuring a MessageRecipient&nbsp;object on the server. Let's simply print out all objects&nbsp;that arrive as messages. For the following we assume that we already&nbsp;have an ObjectServer object, opened with <a href="ClientServer.html#ClientServer">Db4o.openServer()</a>&nbsp;.<br>
<br>
<table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td class="lg">
<code>objectServer.ext().configure().setMessageRecipient( <br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;new MessageRecipient() {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public void processMessage(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectContainer objectContainer, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object message) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// message objects will arrive in this code block<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(message);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;});<br>
</code></td></tr></table>
<br>
<br>
Here is what we would do on the client to send the message:<br>
<br>
<table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td class="lg">
<code>MessageSender sender = <br>
&nbsp;&nbsp;clientObjectContainer.ext().configure().getMessageSender();<br>
&nbsp;&nbsp;<br>
sender.send(new MyClientServerMessage("Hello from client.");<br>
</code></td></tr></table>
<br>
<br>
The MessageSender object on the client can be reused to send&nbsp;multiple messages.<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>
<br>
<br>
<br>
<br><br><br><small>--<br>generated by </small><a href="http://www.db4objects.com/doctor/" target=_top><small>Doctor</small></a><small> courtesy of </small><a href="http://www.db4objects.com" target=_top><small>db4objects Inc.</small></a><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></td></tr></table></div></body></html>