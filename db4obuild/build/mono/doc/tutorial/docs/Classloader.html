<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="stylesheet" type="text/css" href="docs.css">
</head>
<body><div id="pagecontainer"><table><tr><td width="5">&nbsp;</td><td><a name="Classloader"></a><br>
<a name="outline540"></a><br><h1>16. Classloader issues</h1><br>
Db4o needs to know its own classes, of course, and it needs to know&nbsp;the class definitions of the objects it stores. (In Client/Server mode,&nbsp;both the server and the clients need access to the class definitions.)&nbsp;While this usually is a non-issue with self-contained standalone&nbsp;applications, it can become tricky to ensure this condition when&nbsp;working with plugin frameworks, where one might want to deploy db4o&nbsp;as a shared library for multiple plugins, for example.<br>
<br>
<ul>
<a name="outline541"></a><br><h2>16.1. Classloader basics</h2><br>
Classloaders are organized in a tree structure, where classloaders deeper&nbsp;down the tree (usually) delegate requests to their parent classloaders&nbsp;and thereby 'share' their parent's knowledge.<br>
<br>
A typical situation might look like this:<br>
<br>
<img border="0" src="classloader.jpg" /><br>
<br>
An in-depth explanation of the workings of classloaders is beyond the&nbsp;scope of this tutorial, of course. Starting points might be found&nbsp;here:<br>
<br>
<a href="http://www.javaworld.com/javaworld/javaqa/2003-06/01-qa-0606-load.html" target="_blank">http://www.javaworld.com/javaworld/javaqa/2003-06/01-qa-0606-load.html</a><br>
<a href="http://java.sun.com/developer/technicalArticles/Networking/classloaders/" target="_blank">http://java.sun.com/developer/technicalArticles/Networking/classloaders/</a><br>
<a href="http://java.sun.com/products/jndi/tutorial/beyond/misc/classloader.html" target="_blank">http://java.sun.com/products/jndi/tutorial/beyond/misc/classloader.html</a><br>
<br>
<a name="outline542"></a><br><h2>16.2. Configuration</h2><br>
Db4o can be configured to use a user-defined classloader.<br>
<br>
<table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td class="lg">
<code>&nbsp;Db4o.configure().reflectWith(new JdkReflector(classloader));<br>
</code></td></tr></table>
<br>
<br>
This line will configure db4o to use the provided classloader. Note that,&nbsp;as with most db4o configuration options, this configuration will have to&nbsp;occur before the respective database has been opened.<br>
<br>
The usual ways of getting a classloader reference are:<br>
<br>
- Using the classloader the class containing the currently executed&nbsp;code was loaded from. (<em>this.getClass().getClassLoader()</em>)<br>
- Using the classloader db4o was loaded from. (<em>Db4o.class.getClassLoader()</em>)<br>
- Using the classloader your domain classes were loaded from. (<em>SomeDomainClass.class.getClassLoader()</em>)<br>
- Using the context classloader that may have been arbitrarily&nbsp;set by the execution environment. (<em>Thread.currentThread().getContextClassLoader()</em>).<br>
<br>
To choose the right classloader to use, you have to be aware of the&nbsp;classloader hierarchy of your specific execution environment. As a rule&nbsp;of thumb, one should configure db4o to use a classloader as&nbsp;deep/specialized in the tree as possible. In the above example this&nbsp;would be the classloader of the plugin db4o is supposed to work with.<br>
<br>
<a name="outline543"></a><br><h2>16.3. Typical Environments</h2><br>
In your average standalone program you'll probably never have to face these&nbsp;problems, but there are standard framework classics that'll force you to think about&nbsp;these issues.<br>
<br>
<ul>
<a name="outline544"></a><br><h2>16.3.1. Servlet container</h2><br>
In a typical servlet container, there will be one or more classloader responsible&nbsp;for internal container classes and shared libraries, and one dedicated classloader&nbsp;per deployed web application. If you deploy db4o within your web application, there&nbsp;should be no problem at all. When used as a shared library db4o has to be configured&nbsp;to use the dedicated web application classloader. This can be done by assigning the&nbsp;classloader of a class that's present in the web application only, or by using the&nbsp;context classloader, since all servlet container implementations we are aware of&nbsp;will set it accordingly.<br>
<br>
You will find more detailed information on classloader handling in Tomcat, the&nbsp;reference servlet container implementation, here:<br>
<br>
<a href="http://jakarta.apache.org/tomcat/tomcat-4.1-doc/class-loader-howto.html" target="_blank">http://jakarta.apache.org/tomcat/tomcat-4.1-doc/class-loader-howto.html</a><br>
<br>
<a name="outline545"></a><br><h2>16.3.2. Eclipse</h2><br>
Eclipse uses the system classloader to retrieve its core classes. There is one&nbsp;dedicated classloader per plugin, and the classloader delegation tree will&nbsp;resemble the plugin dependency tree. The context classloader will&nbsp;usually be the system classloader that knows nothing about db4o and your&nbsp;business classes. So the best candidate is the classloader for one of your&nbsp;domain classes within the plugin.<br>
<br>
</ul>
<a name="outline546"></a><br><h2>16.4. Running without classes</h2><br>
Recently db4o has started to learn to cope with missing class definitions.&nbsp;This is a by-product of the work on our <a href="ObjectManager.html#ObjectManager">object manager application</a>. However,&nbsp;this feature is still quite restricted (read-only mode, etc.), incomplete and&nbsp;is under heavy development. If you like to play with this feature and help&nbsp;us with your feedback to enhance it, you are welcome, but we strongly recommend&nbsp;not to try to use this for production code of any kind.<br><br><br><small>--<br>generated by </small><a href="http://www.db4objects.com/doctor/" target=_top><small>Doctor</small></a><small> courtesy of </small><a href="http://www.db4objects.com" target=_top><small>db4objects Inc.</small></a><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></td></tr></table></div></body></html>