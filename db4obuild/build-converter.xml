<?xml version="1.0"?>
<project name="CSharpConverter" default="compile-converter2">

	<property file="machine.properties" />
	<property file="ant.properties" />
	
	<property name="converter.exe" location="bin/CSharpConverter.exe" />
	
	<condition property="mono" value="1">
		<os family="unix" />
	</condition>
		
	<target name="compile-converter2" depends="init">
		<csc srcdir="src/CSharpConverter"
			outputfile="bin/CSharpConverter.exe"
			executable="${csc.executable}">
			<reference dir="bin">
				<include name="ICSharpCode.NRefactory.dll" />
			</reference>
		</csc>
	</target>
	
	<target name="detect-dotnet" unless="mono">
		<property environment="env" />		
		<property name="csc.executable.path.net2" location="${env.SystemRoot}/Microsoft.NET/Framework/v2.0.50727" />
		<property name="csc.executable" location="${csc.executable.path.net2}/csc.exe" />		
	</target>
		
	<target name="detect-mono" if="mono">
		<property name="csc.executable" value="gmcs" />
	</target>
	
	<target name="detect-environment" depends="detect-mono, detect-dotnet">
	</target>
	
	<target name="clean">
		<delete dir="bin" />
	</target>
		
	<target name="init" depends="detect-environment">
		<mkdir dir="bin" />
		<copy todir="bin">
			<fileset dir="lib/SharpDevelop">
				<include name="ICSharpCode.NRefactory.dll" />
			</fileset>
		</copy>
	</target>
	
</project>
