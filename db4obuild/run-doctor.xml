<?xml version="1.0"?>
<project name="rundoctor" default="runalldoctortasks" basedir=".">

<!--
    Don't run this build script directly, it is only meant as
    a suttlement to build.xml.

	The target to run doctor was factored out of the normal build.xml
    to allow Ant to put together the classpath when the	target is 
    started. That way it seems easier for Ant to find the necessary 
    jars and the target can run successfully after clean. 
-->

	<import file="common.xml" />
	
	<property name="file.keystore" value="${user.home}/.keystore" />
	
	<target name="init" description="Basic initialization">
		<tstamp />
		<mkdir dir="${dir.dist.doctor}" />
	</target>
	
	<target name="compileandsign" description="compiles and signs the libraries necessary for doctor tasks">
		<mkdir dir="${dir.dist.doctor}" />
		<javac srcdir="${dir.doctor.src}" destdir="${dir.dist.doctor}" target="1.3" source="1.3" fork="true" encoding="UTF-8">			
			<include name="**/com/yetac/doctor/applet/*.java"/>
		</javac>
		<jar destfile="${file.doctor.applets.jar}">
			<fileset dir="${dir.dist.doctor}" includes="**/com/yetac/doctor/applet/*.class" />
		</jar>
		<signjar keystore="${file.keystore}" jar="${file.doctor.applets.jar}" alias="db4objects" keypass="kistoa" storepass="kistoa" />
		<jar destfile="${file.tutorial.jar}">
			<fileset dir="${dir.dist.classes.tutorial}" includes="com/db4o/f1/**/*.class" />
		</jar>
		<signjar keystore="${file.keystore}" jar="${file.tutorial.jar}" alias="db4objects" keypass="kistoa" storepass="kistoa" />
<!--
		<jar destfile="${file.reference.jar}">
			<fileset dir="${dir.dist.classes.reference}" includes="com/db4odoc/f1/**/*.class" />
		</jar>
		<signjar keystore="${file.keystore}" jar="${file.reference.jar}" alias="db4objects" keypass="kistoa" storepass="kistoa" />
-->
		<copy todir="${dir.dist.doctor}" overwrite="true">
			<fileset file="${file.nqopt.jar}" />
			<fileset file="${file.bloat.jar}" />
		</copy>
		<signjar keystore="${file.keystore}" jar="${dir.dist.doctor}/${filename.nqopt.jar}" alias="db4objects" keypass="kistoa" storepass="kistoa" />
		<signjar keystore="${file.keystore}" jar="${dir.dist.doctor}/${filename.bloat.jar}" alias="db4objects" keypass="kistoa" storepass="kistoa" />
	</target>
	
	<target name="runalldoctortasks" depends="compileandsign, rundoctors" description="Run all doctor tasks">
	</target>
	
	
	<target name="rundoctors" description="Run all doctor tasks">
		<doctor 
			name="f1" 
			home="${dir.j.tutorial}" 
			interactive="true" 
			workspace="${dir.base}" 
			inputsource="${dir.j.tutorial.src}/" 
			sourceextension="java" 
			outputfile="db4o-${db4o.version.dotted}-tutorial" 
			outputpath="${dir.j.tutorial.out.java}" 
			pdfbasefont="${font.pdf.base}" 
			archive="${filename.doctor.applets.jar}, ${filename.java1.2.jar}, ${filename.tutorial.jar}" 
			outlineimage="db4objects1.jpg" 
			linkhome="http://www.db4o.com">
			<variable name="java" boolean="true" />
			<variable name="net" boolean="false" />
			<variable name="mono" boolean="false" />
			<ignoreinputfolder name="net" />
			<ignoreinputfolder name="mono" />
		</doctor>
		<copy todir="${dir.j.tutorial.out.java}/docs" overwrite="true">
			<fileset dir="${dir.dist.doctor}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${dir.dist.jars}">
				<include name="${filename.java1.2.jar}" />
			</fileset>
		</copy>
		<signjar keystore="${file.keystore}" jar="${dir.j.tutorial.out.java}/docs/${filename.java1.2.jar}" alias="db4objects" keypass="kistoa" storepass="kistoa" />
		<doctor 
			name="f1" 
			home="${dir.j.tutorial}" 
			interactive="true" 
			workspace="${dir.base}" 
			inputsource="${dir.n.v6.tutorial.src}/" 
			sourcepathresolver="com.yetac.doctor.cmd.DotNetTutorialSourcePathResolver"
			sourceextension="cs" 
			outputfile="db4o-${db4o.version.dotted}-tutorial" 
			outputpath="${dir.j.tutorial.out.net}" 
			pdfbasefont="${font.pdf.base}" 
			archive="${filename.doctor.applets.jar}, ${filename.java1.2.jar}, ${filename.tutorial.jar}" 
			outlineimage="db4objects1.jpg" 
			linkhome="http://www.db4o.com">
			<variable name="java" boolean="false" />
			<variable name="net" boolean="true" />
			<variable name="mono" boolean="false" />
			<ignoreinputfolder name="java" />
			<ignoreinputfolder name="mono" />
		</doctor>
		<doctor 
			name="f1" 
			home="${dir.j.tutorial}" 
			interactive="false" 
			showcodeexecutionresults="true"
			workspace="${dir.base}" 
			inputsource="${dir.n.v6.tutorial.src}/" 
			sourcepathresolver="com.yetac.doctor.cmd.DotNetTutorialSourcePathResolver"
			sourceextension="cs" 
			outputfile="db4o-${db4o.version.dotted}-tutorial" 
			outputpath="${dir.j.tutorial.out.mono}" 
			pdfbasefont="${font.pdf.base}" 
			archive="${filename.doctor.applets.jar}, ${filename.java1.2.jar}, ${filename.tutorial.jar}" 
			outlineimage="db4objects1.jpg" 
			linkhome="http://www.db4o.com">
			<variable name="java" boolean="false" />
			<variable name="net" boolean="false" />
			<variable name="mono" boolean="true" />
			<ignoreinputfolder name="java" />
			<ignoreinputfolder name="net" />
		</doctor>
		<!--
		<doctor 
			name="f1" 
			home="${dir.j.tutorial}" 
			interactive="false" 
			showcodeexecutionresults="true"
			workspace="${dir.base}" 
			inputsource="${dir.n.v6.tutorial.src.vb}/" 
			sourceextension="vb" 
			outputfile="db4o-${db4o.version.dotted}-tutorial" 
			outputpath="${dir.j.tutorial.out.vb}" 
			pdfbasefont="${font.pdf.base}" 
			archive="${filename.doctor.applets.jar}, ${filename.java1.2.jar}, ${filename.tutorial.jar}" 
			outlineimage="db4objects1.jpg" 
			linkhome="http://www.db4o.com">
			<variable name="java" boolean="false" />
			<variable name="net" boolean="true" />
			<variable name="mono" boolean="false" />
			<ignoreinputfolder name="java" />
			<ignoreinputfolder name="mono" />
		</doctor> 
		-->
	</target>

	<target name="testdoctor">
		<doctor name="doctor_utf" workspace="${dir.base}" pdfbasefont="${font.pdf.base}" />
	</target>
</project>
	